<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>盤匠 - bansyou</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="./styles.css">
</head>
<body class="page">
  <header class="topbar">
    <div>
      <div class="brand">盤匠</div>
      <div class="subtitle">盤と駒を設計して遊ぶ</div>
    </div>
  </header>

  <main>
    <section class="hero">
      <h1>自分だけの盤面と駒で遊ぶ</h1>
      <p>
        盤を作成し、駒の動きを設計して、ゲームの初期配置とルールをまとめます。
        保存データはブラウザ内（ローカルストレージ）に保持されます。
      </p>
    </section>

    <section class="grid">
      <article class="tile">
        <h3>盤作成</h3>
        <p>マス数と通行不可マスを設定して、盤の土台を作ります。</p>
        <a class="btn secondary" href="./board-create.html">盤作成へ</a>
      </article>
      <article class="tile">
        <h3>駒作成</h3>
        <p>動き方を配置して、独自の駒セットを用意します。</p>
        <a class="btn secondary" href="./piece-create.html">駒作成へ</a>
      </article>
      <article class="tile">
        <h3>ゲーム作成</h3>
        <p>盤と駒を配置し、持ち駒ルールを設定して保存します。</p>
        <a class="btn secondary" href="./game-setup.html">ゲーム作成へ</a>
      </article>
      <article class="tile">
        <h3>盤一覧</h3>
        <p>作成した盤を確認・編集・削除します。</p>
        <a class="btn secondary" href="./board-list.html">盤一覧へ</a>
      </article>
      <article class="tile">
        <h3>駒一覧</h3>
        <p>作成した駒を確認・編集・削除します。</p>
        <a class="btn secondary" href="./piece-list.html">駒一覧へ</a>
      </article>
      <article class="tile">
        <h3>ゲーム一覧</h3>
        <p>作成したゲームを確認・編集・削除します。</p>
        <a class="btn secondary" href="./game-list.html">ゲーム一覧へ</a>
      </article>
      <article class="tile">
        <h3>作成したゲームをプレイする</h3>
        <p>保存済みゲームを選び、盤上で動かして確認します。</p>
        <div class="row">
          <select id="play-game-list"></select>
          <button class="btn secondary" id="play-btn">プレイ</button>
        </div>
        <div id="play-msg" class="msg err"></div>
      </article>
    </section>
  </main>

  <script src="./storage.js"></script>
  <script>
    const storage = window.BansyouStorage;
    const listEl = document.getElementById("play-game-list");
    const playBtn = document.getElementById("play-btn");
    const msgEl = document.getElementById("play-msg");

    function loadGames() {
      const games = storage.listGames();
      listEl.innerHTML = "";
      if (!games.length) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "ゲームがありません";
        listEl.appendChild(opt);
        listEl.disabled = true;
        playBtn.disabled = true;
        return;
      }
      games.forEach((g) => {
        const opt = document.createElement("option");
        opt.value = g.name;
        opt.textContent = g.name;
        listEl.appendChild(opt);
      });
      listEl.disabled = false;
      playBtn.disabled = false;
    }

    playBtn.addEventListener("click", () => {
      msgEl.textContent = "";
      const name = listEl.value;
      if (!name) {
        msgEl.textContent = "ゲームを選択してください。";
        return;
      }
      location.href = `./play.html?game=${encodeURIComponent(name)}`;
    });

    loadGames();
  </script>
</body>
</html>
