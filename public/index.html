<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>盤匠 - bansyou</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="./styles.css">
</head>
<body class="page">
  <header class="topbar">
    <div>
      <div class="brand">盤匠</div>
      <div class="subtitle">盤と駒を設計して遊ぶ</div>
    </div>
  </header>

  <main>
    <section class="home-intro">
      <div class="home-title">磐匠</div>
      <div class="home-subtitle">盤と駒を自由に設計して遊ぶことができます。</div>
    </section>

    <section class="grid home-grid">
      <div class="card">
        <div class="label">盤作成</div>
        <div class="note">マス数と通行不可マスを設定して、盤の土台を作ります。</div>
        <a class="btn secondary" href="./board-create.html">盤作成</a>
      </div>
      <div class="card">
        <div class="label">駒作成</div>
        <div class="note">動き方を配置して、独自の駒セットを用意します。</div>
        <a class="btn secondary" href="./piece-create.html">駒作成</a>
      </div>
      <div class="card">
        <div class="label">ゲーム作成</div>
        <div class="note">盤と駒を配置し、持ち駒ルールを設定して保存します。</div>
        <a class="btn secondary" href="./game-setup.html">ゲーム作成</a>
      </div>
      <div class="card">
        <div class="label">盤一覧</div>
        <div class="note">作成した盤を確認・編集・削除します。</div>
        <a class="btn secondary" href="./board-list.html">盤一覧</a>
      </div>
      <div class="card">
        <div class="label">駒一覧</div>
        <div class="note">作成した駒を確認・編集・削除します。</div>
        <a class="btn secondary" href="./piece-list.html">駒一覧</a>
      </div>
      <div class="card">
        <div class="label">ゲーム一覧</div>
        <div class="note">作成したゲームを確認・編集・削除します。</div>
        <a class="btn secondary" href="./game-list.html">ゲーム一覧</a>
      </div>
      <div class="card center-row">
        <div class="label">作成したゲームをプレイする</div>
        <div class="note">保存済みゲームを選び、盤上で動かして確認します。</div>
        <div class="row">
          <select id="play-game-list"></select>
          <button class="btn secondary" id="play-btn">プレイ</button>
        </div>
        <div id="play-msg" class="msg err"></div>
      </div>
    </section>
  </main>

  <script src="./storage.js"></script>
  <script>
    const storage = window.BansyouStorage;
    const listEl = document.getElementById("play-game-list");
    const playBtn = document.getElementById("play-btn");
    const msgEl = document.getElementById("play-msg");

    function loadGames() {
      const games = storage.listGames();
      listEl.innerHTML = "";
      if (!games.length) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "ゲームがありません";
        listEl.appendChild(opt);
        listEl.disabled = true;
        playBtn.disabled = true;
        return;
      }
      games.forEach((g) => {
        const opt = document.createElement("option");
        opt.value = g.name;
        opt.textContent = g.name;
        listEl.appendChild(opt);
      });
      listEl.disabled = false;
      playBtn.disabled = false;
    }

    playBtn.addEventListener("click", () => {
      msgEl.textContent = "";
      const name = listEl.value;
      if (!name) {
        msgEl.textContent = "ゲームを選択してください。";
        return;
      }
      location.href = `./play.html?game=${encodeURIComponent(name)}`;
    });

    loadGames();
  </script>
</body>
</html>
